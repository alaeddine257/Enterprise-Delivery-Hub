{% extends 'base.html' %}

{% block content %}
<section class="panel">
  <h2>Executive Snapshot</h2>
  <div class="kpi-grid">
    <div class="kpi-card" data-kpi>
      <p>Total Projects</p>
      <h3 data-kpi-total>{{ project_stats['total'] or 0 }}</h3>
      <span class="muted">Backlog <span data-kpi-backlog>{{ project_stats['backlog'] or 0 }}</span> · In Progress <span data-kpi-inprogress>{{ project_stats['in_progress'] or 0 }}</span></span>
    </div>
    <div class="kpi-card" data-kpi>
      <p>Tasks In Flight</p>
      <h3 data-kpi-tasks>{{ task_stats['total'] or 0 }}</h3>
      <span class="muted">Blocked <span data-kpi-blocked>{{ task_stats['blocked'] or 0 }}</span> · Done <span data-kpi-done>{{ task_stats['done'] or 0 }}</span></span>
    </div>
    <div class="kpi-card" data-kpi>
      <p>Active Risks</p>
      <h3 data-kpi-openrisks>{{ risk_stats['open'] or 0 }}</h3>
      <span class="muted">Mitigated {{ risk_stats['mitigated'] or 0 }} · Accepted {{ risk_stats['accepted'] or 0 }}</span>
    </div>
    <div class="kpi-card" data-kpi>
      <p>At Risk Projects</p>
      <h3 data-kpi-atrisk>{{ project_stats['at_risk'] or 0 }}</h3>
      <span class="muted">Closed <span data-kpi-closed>{{ project_stats['closed'] or 0 }}</span></span>
    </div>
  </div>
</section>

<section class="panel-grid">
  <section class="panel">
    <h2>Recent Projects</h2>
    <div class="table">
      <div class="table-row table-header">
        <div>Project</div>
        <div>Owner</div>
        <div>Status</div>
        <div>Department</div>
      </div>
      {% for project in recent_projects %}
      <div class="table-row">
        <div>{{ project['name'] }}</div>
        <div>{{ project['owner'] }}</div>
        <div><span class="status {{ project['status'] | lower | replace(' ', '-') }}">{{ project['status'] }}</span></div>
        <div>{{ project['department'] or 'Unassigned' }}</div>
      </div>
      {% else %}
      <div class="empty-state">No projects yet. Add initiatives in the Projects page.</div>
      {% endfor %}
    </div>
  </section>

  <section class="panel">
    <h2>Operational Updates</h2>
    <div class="timeline">
      {% for update in recent_updates %}
      <div class="timeline-item">
        <div>
          <strong>{{ update['project_name'] }}</strong>
          <p>{{ update['summary'] }}</p>
          <span class="muted">{{ update['created_at'] }}</span>
        </div>
      </div>
      {% else %}
      <div class="empty-state">No updates captured yet.</div>
      {% endfor %}
    </div>
  </section>
</section>

<section class="panel-grid">
  <section class="panel">
    <h2>Upcoming Tasks</h2>
    <ul class="list">
      {% for task in upcoming_tasks %}
      <li>
        <div>
          <strong>{{ task['title'] }}</strong>
          <span class="muted">{{ task['project_name'] }}</span>
        </div>
        <span class="badge">Due {{ task['due_date'] }}</span>
      </li>
      {% else %}
      <li class="muted">No upcoming tasks scheduled.</li>
      {% endfor %}
    </ul>
  </section>

  <section class="panel">
    <h2>Open Risks</h2>
    <ul class="list">
      {% for risk in open_risks %}
      <li>
        <div>
          <strong>{{ risk['title'] }}</strong>
          <span class="muted">{{ risk['project_name'] }}</span>
        </div>
        <span class="badge danger">{{ risk['impact'] }} / {{ risk['likelihood'] }}</span>
      </li>
      {% else %}
      <li class="muted">No open risks recorded.</li>
      {% endfor %}
    </ul>
  </section>
</section>
{% endblock %}
